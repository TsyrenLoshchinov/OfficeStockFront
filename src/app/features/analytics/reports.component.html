<div class="main__container">
  <h1 class="main__title">Отчётность</h1>

  <!-- Вкладки -->
  <div class="tabs">
    <button class="tab" [class.tab--active]="activeTab() === 'expenses'" (click)="setActiveTab('expenses')">
      Расходы
    </button>
    <button class="tab" [class.tab--active]="activeTab() === 'suppliers'" (click)="setActiveTab('suppliers')">
      Поставщики
    </button>
  </div>

  <!-- Фильтры для вкладок "Расходы" и "Поставщики" -->
  <div class="filters" *ngIf="activeTab() === 'expenses' || activeTab() === 'suppliers'">
    <div class="filter-section">
      <div class="filter-header" (click)="toggleFilterSection('period')">
        <span class="filter-title" [class.filter-title--active]="isFilterSectionOpen('period')">Период</span>
        <span class="filter-arrow" [class.filter-arrow--open]="isFilterSectionOpen('period')">▼</span>
      </div>
      <div class="filter-content" *ngIf="isFilterSectionOpen('period')">
        <div class="filter-dates">
          <div class="date-input">
            <label>С:</label>
            <input type="date" [value]="dateFrom()" (change)="onDateFromChange($any($event.target).value)">
          </div>
          <div class="date-input">
            <label>По:</label>
            <input type="date" [value]="dateTo()" (change)="onDateToChange($any($event.target).value)">
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Вкладка: Расходы -->
  <div class="tab-content" *ngIf="activeTab() === 'expenses'">
    <div class="table-container">
      <table class="reports-table">
        <thead>
          <tr>
            <th>Категория</th>
            <th>Было потрачено</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let expense of expensesData()">
            <td>{{ expense.category }}</td>
            <td class="amount-cell">{{ expense.amount.toFixed(2) }}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="summary">
      <p>Общая сумма расходов за этот период: <span class="summary-amount">{{ totalExpenses().toFixed(2) }}</span></p>
    </div>
    <div class="button-group">
      <button class="visualize-button" (click)="openVisualization()">Визуализировать</button>
      <button class="download-button" (click)="downloadReport('expenses')">Скачать отчёт</button>
    </div>
  </div>

  <!-- Вкладка: Поставщики -->
  <div class="tab-content" *ngIf="activeTab() === 'suppliers'">
    <div class="table-container">
      <table class="reports-table">
        <thead>
          <tr>
            <th>Наименование</th>
            <th>Общая сумма закупок</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let supplier of suppliersData()">
            <td>{{ supplier.name }}</td>
            <td class="amount-cell">{{ supplier.totalAmount.toFixed(2) }}</td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="summary">
      <p>Общая сумма расходов за этот период: <span class="summary-amount">{{ totalSuppliersExpenses().toFixed(2)
          }}</span></p>
    </div>
    <button class="download-button" (click)="downloadReport('suppliers')">Скачать отчёт</button>
  </div>
</div>

<!-- Модальное окно визуализации -->
<div class="modal-overlay" *ngIf="showVisualization()" appModalContainer (click)="closeVisualization()">
  <div class="modal-content visualization-modal" (click)="$event.stopPropagation()">
    <button class="modal-close" (click)="closeVisualization()" aria-label="Закрыть" type="button">
      <span class="close-line"></span>
      <span class="close-line"></span>
    </button>

    <h2 class="visualization-title">Визуализация данных</h2>

    <!-- Столбчатая диаграмма -->
    <div class="chart-container">
      <canvas #barChart id="barChart"></canvas>
    </div>

    <!-- Круговая диаграмма -->
    <div class="chart-container">
      <h3 class="chart-title">Отношение расходов по категориям</h3>
      <div class="donut-chart-wrapper">
        <canvas #donutChart id="donutChart"></canvas>
        <div class="donut-center">
          <span class="donut-center-value">{{ totalExpenses().toFixed(0) }}</span>
        </div>
      </div>
      <div class="chart-legend">
        <div class="legend-item" *ngFor="let category of categoryData()">
          <span class="legend-color" [style.background-color]="category.color"></span>
          <span class="legend-label">{{ category.name }}</span>
        </div>
      </div>
    </div>
  </div>
</div>