<div class="admin-page">
  <h1 class="admin-page__title">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ</h1>

  <div class="admin-page__controls">
    <app-custom-dropdown
      [options]="filterOptions"
      [selectedValue]="filterRole()"
      [width]="'328px'"
      [height]="'63px'"
      [menuLeft]="'73px'"
      [menuTop]="'73px'"
      [menuWidth]="'255px'"
      (valueChange)="onFilterChange($event)">
    </app-custom-dropdown>

    <button class="add-button" type="button" (click)="openAddModal()">
      –î–æ–±–∞–≤–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞
    </button>
  </div>

  <div class="employees-table">
    <div class="employees-table__header">
      <div class="employees-table__cell employees-table__cell--id">Id</div>
      <div class="employees-table__cell employees-table__cell--name">–§–ò–û</div>
      <div class="employees-table__cell employees-table__cell--email">–ü–æ—á—Ç–∞</div>
      <div class="employees-table__cell employees-table__cell--role">–†–æ–ª—å</div>
      <div class="employees-table__cell employees-table__cell--actions"></div>
    </div>

    <div class="employees-table__body">
      <div class="employee-row" *ngFor="let employee of employees()">
        <div class="employee-row__cell employee-row__cell--id">{{ employee.id }}</div>
        <div class="employee-row__cell employee-row__cell--name">{{ getFullName(employee) }}</div>
        <div class="employee-row__cell employee-row__cell--email">{{ employee.email.toLowerCase() }}</div>
        <div class="employee-row__cell employee-row__cell--role">{{ getRoleLabel(employee.role) }}</div>
        <div class="employee-row__cell employee-row__cell--actions">
          <button class="action-button" type="button" (click)="openEditModal(employee)">–ò–∑–º–µ–Ω–∏—Ç—å</button>
          <button class="action-button" type="button" (click)="openDeleteModal(employee)">–£–¥–∞–ª–∏—Ç—å</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è -->
<div class="modal-overlay" *ngIf="showAddModal()" appModalContainer (click)="closeAddModal()">
  <div class="modal modal--add" (click)="$event.stopPropagation()">
    <button class="modal__close" type="button" (click)="closeAddModal()">
      <span class="modal__close-line"></span>
      <span class="modal__close-line"></span>
    </button>
    <h2 class="modal__title">–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h2>
    
    <form [formGroup]="addForm" (ngSubmit)="onAddSubmit()" class="modal__form">
      <div class="input-field">
        <input 
          type="text" 
          formControlName="lastName" 
          placeholder=" " 
          class="input-field__input"
          [class.input-field__input--error]="isFieldInvalid('lastName', 'add')">
        <label class="input-field__label">–§–∞–º–∏–ª–∏—è*</label>
        <div class="input-field__line"></div>
        <div *ngIf="isFieldInvalid('lastName', 'add')" class="input-field__error">
          {{ getFieldError('lastName', 'add') }}
        </div>
      </div>

      <div class="input-field">
        <input 
          type="text" 
          formControlName="firstName" 
          placeholder=" " 
          class="input-field__input"
          [class.input-field__input--error]="isFieldInvalid('firstName', 'add')">
        <label class="input-field__label">–ò–º—è*</label>
        <div class="input-field__line"></div>
        <div *ngIf="isFieldInvalid('firstName', 'add')" class="input-field__error">
          {{ getFieldError('firstName', 'add') }}
        </div>
      </div>

      <div class="input-field">
        <input 
          type="text" 
          formControlName="middleName" 
          placeholder=" " 
          class="input-field__input"
          [class.input-field__input--error]="isFieldInvalid('middleName', 'add')">
        <label class="input-field__label">–û—Ç—á–µ—Å—Ç–≤–æ</label>
        <div class="input-field__line"></div>
        <div *ngIf="isFieldInvalid('middleName', 'add')" class="input-field__error">
          {{ getFieldError('middleName', 'add') }}
        </div>
      </div>

      <div class="input-field">
        <input 
          type="email" 
          formControlName="email" 
          placeholder=" " 
          class="input-field__input"
          [class.input-field__input--error]="isFieldInvalid('email', 'add')">
        <label class="input-field__label">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞*</label>
        <div class="input-field__line"></div>
        <div *ngIf="isFieldInvalid('email', 'add')" class="input-field__error">
          {{ getFieldError('email', 'add') }}
        </div>
      </div>

      <div class="input-field input-field--select">
        <select 
          formControlName="role" 
          class="input-field__select"
          [class.input-field__input--error]="isFieldInvalid('role', 'add')">
          <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–æ–ª—å</option>
          <option value="hr-manager">HR-–º–µ–Ω–µ–¥–∂–µ—Ä</option>
          <option value="economist">–≠–∫–æ–Ω–æ–º–∏—Å—Ç</option>
          <option value="director">–î–∏—Ä–µ–∫—Ç–æ—Ä</option>
          <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
        </select>
        <label class="input-field__label">–†–æ–ª—å*</label>
        <div class="input-field__line"></div>
        <div *ngIf="isFieldInvalid('role', 'add')" class="input-field__error">
          {{ getFieldError('role', 'add') }}
        </div>
      </div>

      <div class="input-field input-field--password">
        <input 
          [type]="showPasswordAdd() ? 'text' : 'password'" 
          formControlName="password" 
          placeholder=" " 
          class="input-field__input"
          [class.input-field__input--error]="isFieldInvalid('password', 'add')"
          [readonly]="addForm.get('generatePassword')?.value">
        <label class="input-field__label">–ü–∞—Ä–æ–ª—å</label>
        <div class="input-field__line"></div>
        <button 
          type="button" 
          class="input-field__toggle-password"
          (click)="togglePasswordVisibility('add')"
          *ngIf="!addForm.get('generatePassword')?.value"
          aria-label="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å">
          <span *ngIf="showPasswordAdd()">üëÅÔ∏è</span>
          <span *ngIf="!showPasswordAdd()">üëÅÔ∏è‚Äçüó®Ô∏è</span>
        </button>
        <div *ngIf="isFieldInvalid('password', 'add')" class="input-field__error">
          {{ getFieldError('password', 'add') }}
        </div>
      </div>

      <div class="checkbox-field">
        <input 
          type="checkbox" 
          formControlName="generatePassword" 
          id="generate-password" 
          class="checkbox-field__input"
          (change)="onGeneratePasswordChange($any($event.target).checked, 'add')">
        <label for="generate-password" class="checkbox-field__label">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å</label>
      </div>

      <button type="submit" class="modal__button" [disabled]="addForm.invalid">–î–æ–±–∞–≤–∏—Ç—å</button>
    </form>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
<div class="modal-overlay" *ngIf="showEditModal()" appModalContainer (click)="closeEditModal()">
  <div class="modal modal--edit" (click)="$event.stopPropagation()">
    <button class="modal__close" type="button" (click)="closeEditModal()">
      <span class="modal__close-line"></span>
      <span class="modal__close-line"></span>
    </button>
    <h2 class="modal__title">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é</h2>
    
    <form [formGroup]="editForm" (ngSubmit)="onEditSubmit()" class="modal__form">
      <div class="input-field">
        <input 
          type="text" 
          formControlName="lastName" 
          placeholder=" " 
          class="input-field__input"
          [class.input-field__input--error]="isFieldInvalid('lastName', 'edit')">
        <label class="input-field__label">–§–∞–º–∏–ª–∏—è*</label>
        <div class="input-field__line"></div>
        <div *ngIf="isFieldInvalid('lastName', 'edit')" class="input-field__error">
          {{ getFieldError('lastName', 'edit') }}
        </div>
      </div>

      <div class="input-field">
        <input 
          type="text" 
          formControlName="firstName" 
          placeholder=" " 
          class="input-field__input"
          [class.input-field__input--error]="isFieldInvalid('firstName', 'edit')">
        <label class="input-field__label">–ò–º—è*</label>
        <div class="input-field__line"></div>
        <div *ngIf="isFieldInvalid('firstName', 'edit')" class="input-field__error">
          {{ getFieldError('firstName', 'edit') }}
        </div>
      </div>

      <div class="input-field">
        <input 
          type="text" 
          formControlName="middleName" 
          placeholder=" " 
          class="input-field__input"
          [class.input-field__input--error]="isFieldInvalid('middleName', 'edit')">
        <label class="input-field__label">–û—Ç—á–µ—Å—Ç–≤–æ</label>
        <div class="input-field__line"></div>
        <div *ngIf="isFieldInvalid('middleName', 'edit')" class="input-field__error">
          {{ getFieldError('middleName', 'edit') }}
        </div>
      </div>

      <div class="input-field">
        <input 
          type="email" 
          formControlName="email" 
          placeholder=" " 
          class="input-field__input"
          [class.input-field__input--error]="isFieldInvalid('email', 'edit')">
        <label class="input-field__label">–≠–ª–µ–∫—Ç—Ä–æ–Ω–Ω–∞—è –ø–æ—á—Ç–∞*</label>
        <div class="input-field__line"></div>
        <div *ngIf="isFieldInvalid('email', 'edit')" class="input-field__error">
          {{ getFieldError('email', 'edit') }}
        </div>
      </div>

      <div class="input-field input-field--select">
        <select 
          formControlName="role" 
          class="input-field__select"
          [class.input-field__input--error]="isFieldInvalid('role', 'edit')">
          <option value="hr-manager">HR-–º–µ–Ω–µ–¥–∂–µ—Ä</option>
          <option value="economist">–≠–∫–æ–Ω–æ–º–∏—Å—Ç</option>
          <option value="director">–î–∏—Ä–µ–∫—Ç–æ—Ä</option>
          <option value="admin">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</option>
        </select>
        <label class="input-field__label">–†–æ–ª—å*</label>
        <div class="input-field__line"></div>
        <div *ngIf="isFieldInvalid('role', 'edit')" class="input-field__error">
          {{ getFieldError('role', 'edit') }}
        </div>
      </div>

      <div class="input-field input-field--password">
        <input 
          [type]="showPasswordEdit() ? 'text' : 'password'" 
          formControlName="password" 
          placeholder=" " 
          class="input-field__input"
          [class.input-field__input--error]="isFieldInvalid('password', 'edit')"
          [readonly]="editForm.get('generatePassword')?.value">
        <label class="input-field__label">–ü–∞—Ä–æ–ª—å</label>
        <div class="input-field__line"></div>
        <button 
          type="button" 
          class="input-field__toggle-password"
          (click)="togglePasswordVisibility('edit')"
          *ngIf="!editForm.get('generatePassword')?.value"
          aria-label="–ü–æ–∫–∞–∑–∞—Ç—å/—Å–∫—Ä—ã—Ç—å –ø–∞—Ä–æ–ª—å">
          <span *ngIf="showPasswordEdit()">üëÅÔ∏è</span>
          <span *ngIf="!showPasswordEdit()">üëÅÔ∏è‚Äçüó®Ô∏è</span>
        </button>
        <div *ngIf="isFieldInvalid('password', 'edit')" class="input-field__error">
          {{ getFieldError('password', 'edit') }}
        </div>
      </div>

      <div class="checkbox-field">
        <input 
          type="checkbox" 
          formControlName="generatePassword" 
          id="generate-password-edit" 
          class="checkbox-field__input"
          (change)="onGeneratePasswordChange($any($event.target).checked, 'edit')">
        <label for="generate-password-edit" class="checkbox-field__label">–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
      </div>

      <button type="submit" class="modal__button" [disabled]="editForm.invalid">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    </form>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —É–¥–∞–ª–µ–Ω–∏—è -->
<div class="modal-overlay" *ngIf="showDeleteModal()" appModalContainer (click)="closeDeleteModal()">
  <div class="modal modal--delete" (click)="$event.stopPropagation()">
    <button class="modal__close" type="button" (click)="closeDeleteModal()">
      <span class="modal__close-line"></span>
      <span class="modal__close-line"></span>
    </button>
    <h2 class="modal__title">–£–¥–∞–ª–µ–Ω–∏–µ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞</h2>
    
    <p class="modal__message" *ngIf="selectedEmployee">
      –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ –∂–µ–ª–∞–µ—Ç–µ —É–¥–∞–ª–∏—Ç—å —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞<br>
      <span class="modal__message--highlight">id{{ selectedEmployee.id }} {{ getFullName(selectedEmployee) }}</span>
    </p>

    <button type="button" class="modal__button" (click)="onDeleteConfirm()">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
  </div>
</div>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –æ—à–∏–±–∫–∏ -->
<div class="modal-overlay" *ngIf="showErrorModal()" appModalContainer (click)="closeErrorModal()">
  <div class="modal modal--error" (click)="$event.stopPropagation()">
    <button class="modal__close" type="button" (click)="closeErrorModal()">
      <span class="modal__close-line"></span>
      <span class="modal__close-line"></span>
    </button>
    <h2 class="modal__title">–û—à–∏–±–∫–∞</h2>
    
    <p class="modal__message">
      –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å –ø–æ—á—Ç–æ–π<br>
      <span class="modal__message--highlight">{{ errorMessage() }}</span>
    </p>

    <button type="button" class="modal__button" (click)="closeErrorModal()">–û–∫</button>
  </div>
</div>

