<div class="modal-overlay" *ngIf="isVisible" (click)="onOverlayClick($event)" (keydown.escape)="close()" appModalContainer>
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="conteiner">
      <div class="checkName">
        <div class="title">
          <h1>Информация о чеке</h1>
        </div>
        <h2>Чек №{{ getReceiptNumber() }} от {{ formatDate(editedReceipt.purchaseDate) }}</h2>
      </div>

      <div class="basicInformation">
        <h5>Основная информация</h5>
        <p class="organization">Организация: {{ editedReceipt.organization }}</p>
        <p class="date">Дата покупки: {{ formatDate(editedReceipt.purchaseDate) }}</p>
        <p class="sum">Общая сумма: {{ editedReceipt.totalAmount.toFixed(2) }}</p>
      </div>

      <div class="productList">
        <h5>Список товаров</h5>
        <div class="table-row header">
          <div class="grid-name">Название</div>
          <div class="grid-category">Категория</div>
          <div class="grid-price">Стоимость</div>
          <div class="grid-count">Количество</div>
          <div class="grid-total">Итог</div>
        </div>

        <div class="table-row" *ngFor="let item of editedReceipt.items; let i = index">
          <input 
            *ngIf="!isReadOnly"
            type="text" 
            class="grid-name grid-name-input" 
            [(ngModel)]="item.name"
            (blur)="recalculateTotal()">
          <div *ngIf="isReadOnly" class="grid-name">{{ item.name }}</div>
          
          <button
            *ngIf="!isReadOnly"
            type="button"
            class="grid-category grid-category-button"
            (click)="openChangeCategoryModal(i)">
            {{ item.category || 'Не определёно' }}
          </button>
          <div *ngIf="isReadOnly" class="grid-category">{{ item.category || 'Не определёно' }}</div>
          
          <div class="grid-price">{{ item.price.toFixed(2) }}</div>
          
          <input 
            *ngIf="!isReadOnly"
            type="number" 
            class="grid-count grid-count-input" 
            [(ngModel)]="item.quantity"
            min="1"
            (blur)="recalculateTotal()">
          <div *ngIf="isReadOnly" class="grid-count">{{ item.quantity }}</div>
          
          <div class="grid-total">{{ (item.price * item.quantity).toFixed(2) }}</div>
        </div>
      </div>

      <div *ngIf="errorMessage" class="error-message">
        {{ errorMessage }}
      </div>

      <div class="btnModel" *ngIf="!isReadOnly">
        <button class="button" (click)="confirmReceipt()" [disabled]="isSubmitting">
          <span class="button__text">{{ isSubmitting ? 'Подтверждение...' : 'Подтвердить' }}</span>
        </button>
      </div>

      <button class="CheckInfo__close" (click)="close()" aria-label="Закрыть информацию о чеке" type="button"></button>
    </div>
  </div>

  <!-- Модальное окно выбора категории -->
  <app-change-category-modal
    *ngIf="showChangeCategoryModal"
    [currentCategory]="currentItemCategory"
    [itemIndex]="currentItemIndex"
    (categorySelected)="onCategorySelected($event)"
    (addCategoryRequested)="onAddCategoryRequested()"
    (closed)="closeChangeCategoryModal()">
  </app-change-category-modal>

  <!-- Модальное окно подтверждения изменения категории -->
  <app-confirmation-changes-modal
    *ngIf="showConfirmationChangesModal"
    [oldCategory]="currentItemCategory"
    [newCategory]="selectedNewCategory"
    (confirmed)="onConfirmationChangesConfirmed()"
    (closed)="closeConfirmationChangesModal()">
  </app-confirmation-changes-modal>

  <!-- Модальное окно добавления категории -->
  <app-add-category-modal
    *ngIf="showAddCategoryModal"
    (categoryAdded)="onCategoryAdded($event)"
    (closed)="closeAddCategoryModal()">
  </app-add-category-modal>

  <!-- Модальное окно подтверждения добавления категории -->
  <app-confirmation-add-modal
    *ngIf="showConfirmationAddModal"
    [categoryName]="newCategoryToAdd"
    (confirmed)="onConfirmationAddConfirmed()"
    (closed)="closeConfirmationAddModal()">
  </app-confirmation-add-modal>
</div>

