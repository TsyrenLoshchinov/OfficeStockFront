<div class="modal-overlay" *ngIf="isVisible" appModalContainer (click)="onOverlayClick($event)">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <div class="modal-container">
      <button class="modal-close" (click)="close()" aria-label="Закрыть" type="button">
        <span class="close-line"></span>
        <span class="close-line"></span>
      </button>

      <h1 class="modal-title">{{ getModalTitle() }}</h1>

      <div class="input-field">
        <input type="text" class="input-field__input" id="search-input" placeholder=" " autocomplete="off"
          [value]="searchQuery()" [class.input-field__input--error]="hasItemError()" [disabled]="editMode"
          (input)="onSearchChange($any($event.target).value)" (focus)="showDropdown.set(true)" (blur)="onInputBlur()" />
        <label for="search-input" class="input-field__label">Товар*</label>
        <div class="input-field__line"></div>
        <div *ngIf="hasItemError()" class="input-field__error">
          {{ getItemError() }}
        </div>
        <div class="dropdown-list" [class.dropdown-list--visible]="showDropdown() && !editMode">
          <div class="dropdown-list__item" *ngFor="let item of filteredItems()" (click)="onItemClick(item)">
            {{ item.name }}
          </div>
          <div *ngIf="filteredItems().length === 0" class="dropdown-list__empty">
            Товары не найдены
          </div>
        </div>
      </div>

      <div class="frequency-section">
        <span class="frequency-label">Списывать раз в</span>
        <div class="frequency-input-wrapper">
          <input type="number" class="frequency-input" [class.input-field__input--error]="hasIntervalError()"
            [value]="intervalDays()" (input)="onIntervalChange(+$any($event.target).value)" min="1" max="365" />
        </div>
        <span class="frequency-unit">дней</span>
        <div *ngIf="hasIntervalError()" class="input-field__error frequency-error">
          {{ getIntervalError() }}
        </div>
      </div>

      <div class="quantity-section">
        <span class="quantity-label">Количество за списание</span>
        <div class="quantity-input-wrapper">
          <input type="number" class="quantity-input" [class.input-field__input--error]="hasQuantityError()"
            [value]="quantityPerWriteoff()" (input)="onQuantityChange(+$any($event.target).value)" min="1" max="1000" />
        </div>
        <span class="quantity-unit">шт.</span>
        <div *ngIf="hasQuantityError()" class="input-field__error quantity-error">
          {{ getQuantityError() }}
        </div>
      </div>

      <div class="modal-footer">
        <button class="confirm-button" [disabled]="isConfirmButtonDisabled()" (click)="createRule()" type="button">
          {{ getButtonText() }}
        </button>
      </div>
    </div>
  </div>
</div>